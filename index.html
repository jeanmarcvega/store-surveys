<!-- Shopify Survey Form - Matthews London -->
<style>
.survey-container {
  max-width: 650px;
  margin: 40px auto;
  padding: 40px;
  background: #f9f9f9;
  border-radius: 8px;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
}

.survey-container h2 {
  margin: 0 0 8px 0;
  font-size: 20px;
  font-weight: 400;
  color: #000;
  letter-spacing: 0.15em;
  text-transform: uppercase;
}

.survey-container p {
  margin: 0 0 30px 0;
  color: #666;
  font-size: 14px;
}

.question {
  margin-bottom: 28px;
}

.question-label {
  display: block;
  margin-bottom: 12px;
  font-weight: 600;
  color: #000;
  font-size: 14px;
}

.text-input {
  width: 100%;
  padding: 12px 16px;
  border: 1px solid #ddd;
  border-radius: 6px;
  font-size: 14px;
  box-sizing: border-box;
  background: #fff;
}

.text-input:focus {
  outline: none;
  border-color: #888;
}

.radio-group {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.radio-label {
  display: flex;
  align-items: center;
  cursor: pointer;
  font-size: 14px;
  color: #333;
}

.radio-label input[type="radio"] {
  margin-right: 10px;
  width: 18px;
  height: 18px;
  cursor: pointer;
  accent-color: #4A90E2;
}

.checkbox-group {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.checkbox-label {
  display: flex;
  align-items: center;
  cursor: pointer;
  font-size: 14px;
  color: #333;
}

.checkbox-label input[type="checkbox"] {
  margin-right: 10px;
  width: 18px;
  height: 18px;
  cursor: pointer;
  accent-color: #4A90E2;
}

.stars-group {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
}

.star-btn {
  padding: 8px 12px;
  border: 2px solid #ddd;
  background: #fff;
  border-radius: 6px;
  cursor: pointer;
  font-size: 20px;
  transition: all 0.2s;
}

.star-btn:hover {
  border-color: #FFD700;
  transform: scale(1.05);
}

.star-btn.selected {
  border-color: #FFD700;
  background: #fffef0;
}

.submit-btn {
  width: 100%;
  padding: 16px;
  background: #000;
  color: white;
  border: none;
  border-radius: 6px;
  font-size: 15px;
  font-weight: 500;
  cursor: pointer;
  margin-top: 25px;
  transition: background 0.2s;
}

.submit-btn:hover {
  background: #333;
}

.submit-btn:disabled {
  background: #999;
  cursor: not-allowed;
}

.error-message {
  color: #d32f2f;
  font-size: 12px;
  margin-top: 5px;
  display: none;
}
</style>

<div class="survey-container">
  <h2>Quick feedback</h2>
  <p>Answer 5 questions (takes less than 1 minute).</p>
  
  <form id="surveyForm">
    <!-- Q1 -->
    <div class="question">
      <label class="question-label">Q1. What's your name? (Same as used when placing the order)</label>
      <input type="text" class="text-input" name="name" required>
      <div class="error-message" id="nameError">Please enter your name</div>
    </div>

    <!-- Q2 -->
    <div class="question">
      <label class="question-label">Q2. How easy was it to place your order?</label>
      <div class="radio-group">
        <label class="radio-label">
          <input type="radio" name="ease" value="Very easy" required> Very easy
        </label>
        <label class="radio-label">
          <input type="radio" name="ease" value="Easy"> Easy
        </label>
        <label class="radio-label">
          <input type="radio" name="ease" value="Neutral"> Neutral
        </label>
        <label class="radio-label">
          <input type="radio" name="ease" value="Difficult"> Difficult
        </label>
      </div>
      <div class="error-message" id="easeError">Please select an option</div>
    </div>

    <!-- Q3 -->
    <div class="question">
      <label class="question-label">Q3. What made you decide to buy from us?</label>
      <div class="radio-group">
        <label class="radio-label">
          <input type="radio" name="decision" value="Price" required> Price
        </label>
        <label class="radio-label">
          <input type="radio" name="decision" value="Product quality"> Product quality
        </label>
        <label class="radio-label">
          <input type="radio" name="decision" value="Design"> Design
        </label>
        <label class="radio-label">
          <input type="radio" name="decision" value="Reviews"> Reviews
        </label>
        <label class="radio-label">
          <input type="radio" name="decision" value="Social media"> Social media
        </label>
        <label class="radio-label">
          <input type="radio" name="decision" value="Other"> Other
        </label>
      </div>
      <div class="error-message" id="decisionError">Please select an option</div>
    </div>

    <!-- Q4 -->
    <div class="question">
      <label class="question-label">Q4. Is there anything we could improve?</label>
      <div class="radio-group">
        <label class="radio-label">
          <input type="radio" name="improve" value="Website experience" required> Website experience
        </label>
        <label class="radio-label">
          <input type="radio" name="improve" value="Product information"> Product information
        </label>
        <label class="radio-label">
          <input type="radio" name="improve" value="Checkout process"> Checkout process
        </label>
        <label class="radio-label">
          <input type="radio" name="improve" value="Communication / emails"> Communication / emails
        </label>
        <label class="radio-label">
          <input type="radio" name="improve" value="Nothing ‚Äî everything was good"> Nothing ‚Äî everything was good
        </label>
      </div>
      <div class="error-message" id="improveError">Please select an option</div>
    </div>

    <!-- Q5 -->
    <div class="question">
      <label class="question-label">Q5. How many stars would you give this experience?</label>
      <div class="stars-group" id="starsGroup">
        <button type="button" class="star-btn" data-stars="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</button>
        <button type="button" class="star-btn" data-stars="4">‚≠ê‚≠ê‚≠ê‚≠ê</button>
        <button type="button" class="star-btn" data-stars="3">‚≠ê‚≠ê‚≠ê</button>
        <button type="button" class="star-btn" data-stars="2">‚≠ê‚≠ê</button>
        <button type="button" class="star-btn" data-stars="1">‚≠ê</button>
      </div>
      <input type="hidden" name="stars" id="starsInput" required>
      <div class="error-message" id="starsError">Please select a rating</div>
    </div>

    <button type="submit" class="submit-btn">Submit</button>
  </form>
</div>

<script>
(function() {
  const form = document.getElementById('surveyForm');
  const submitBtn = form.querySelector('.submit-btn');
  
  // Handle Q5 stars selection (ROBUST: works even if user clicks inside the button)
  const starsGroup = document.getElementById('starsGroup');
  const starsInput = document.getElementById('starsInput');
  
  starsGroup.addEventListener('click', function(e) {
    const btn = e.target.closest('.star-btn');
    if (!btn) return;

    starsGroup.querySelectorAll('.star-btn').forEach(b => b.classList.remove('selected'));
    btn.classList.add('selected');
    starsInput.value = btn.dataset.stars;
    document.getElementById('starsError').style.display = 'none';
  });
  
  // Form submission
  form.addEventListener('submit', async function(e) {
    e.preventDefault();
    
    // Validation
    let isValid = true;
    const name = form.querySelector('input[name="name"]').value.trim();
    const ease = form.querySelector('input[name="ease"]:checked');
    const decision = form.querySelector('input[name="decision"]:checked');
    const improve = form.querySelector('input[name="improve"]:checked');
    const stars = starsInput.value;
    
    if (!name) {
      document.getElementById('nameError').style.display = 'block';
      isValid = false;
    } else {
      document.getElementById('nameError').style.display = 'none';
    }
    
    if (!ease) {
      document.getElementById('easeError').style.display = 'block';
      isValid = false;
    } else {
      document.getElementById('easeError').style.display = 'none';
    }
    
    if (!decision) {
      document.getElementById('decisionError').style.display = 'block';
      isValid = false;
    } else {
      document.getElementById('decisionError').style.display = 'none';
    }
    
    if (!improve) {
      document.getElementById('improveError').style.display = 'block';
      isValid = false;
    } else {
      document.getElementById('improveError').style.display = 'none';
    }
    
    if (!stars) {
      document.getElementById('starsError').style.display = 'block';
      isValid = false;
    } else {
      document.getElementById('starsError').style.display = 'none';
    }
    
    if (!isValid) return;
    
    // Disable submit button
    submitBtn.disabled = true;
    submitBtn.textContent = 'Submitting...';
    
    // Collect data
    const easeValue = ease.value;
    const decisionValue = decision.value;
    const improveValue = improve.value;
    const starRating = parseInt(stars, 10);
    
    // Open Trustpilot FIRST (before any async operations) for mobile compatibility
    // Mobile browsers block window.open() if not in direct user action
    if (starRating >= 3) {
      window.open('https://www.trustpilot.com/evaluate/matthews-london.com', '_blank');
    }
    
    // Send to Discord
    const webhookUrl = 'https://discord.com/api/webhooks/1461232343284056094/ngraSwBDTI0zJagUf6j_Pem1XbtA14cu-G3U7dXIyEp9u8ppMfPpz8zv4wGolOnVlf-d';
    
    const discordPayload = {
      embeds: [{
        title: 'üìã New Survey Response - Matthews London',
        color: 3066993,
        fields: [
          { name: 'Q1. Name', value: name, inline: false },
          { name: 'Q2. Order Ease', value: easeValue, inline: true },
          { name: 'Q5. Rating', value: '‚≠ê'.repeat(starRating) + ` (${starRating} stars)`, inline: true },
          { name: 'Q3. Decision Factor', value: decisionValue, inline: false },
          { name: 'Q4. Improvement', value: improveValue, inline: false }
        ],
        timestamp: new Date().toISOString()
      }]
    };
    
    try {
      // Send to Discord (use sendBeacon for reliability on redirect)
      const blob = new Blob([JSON.stringify(discordPayload)], { type: 'application/json' });
      if (navigator.sendBeacon) {
        navigator.sendBeacon(webhookUrl, blob);
      } else {
        await fetch(webhookUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(discordPayload)
        });
      }
      
      // Small delay to help ensure the webhook request is sent before redirect
      await new Promise(resolve => setTimeout(resolve, 300));
      
      // Redirect to YOUR GitHub Pages thank you page
      window.location.href = 'thankyou.html';
      
    } catch (error) {
      console.error('Error submitting survey:', error);
      // Still redirect even if Discord fails
      window.location.href = 'thankyou.html';
    }
  });
})();
</script>
